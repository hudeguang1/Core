# Chapter 3-2 分时多任务系统之二 抢占式调度（优先级1）
## 完成情况
* 实现了时钟中断，每次中断切换应用程序。
* 实现了新的系统调用。
* 通过吴一凡同学的测试程序。
* 仍具有应用程序和栈的数量都是指定的，如果应用程序数量改变，需要对代码进行修改。
```
OpenSBI v0.6
   ____                    _____ ____ _____
  / __ \                  / ____|  _ \_   _|
 | |  | |_ __   ___ _ __ | (___ | |_) || |
 | |  | | '_ \ / _ \ '_ \ \___ \|  _ < | |
 | |__| | |_) |  __/ | | |____) | |_) || |_
  \____/| .__/ \___|_| |_|_____/|____/_____|
        | |
        |_|

Platform Name          : QEMU Virt Machine
Platform HART Features : RV64ACDFIMSU
Platform Max HARTs     : 8
Current Hart           : 0
Firmware Base          : 0x80000000
Firmware Size          : 120 KB
Runtime SBI Version    : 0.2

MIDELEG : 0x0000000000000222
MEDELEG : 0x000000000000b109
PMP0    : 0x0000000080000000-0x000000008001ffff (A)
PMP1    : 0x0000000000000000-0xffffffffffffffff (A,R,W,X)
power_3 [10000/200000]
power_5 [10000/200000]
power_5 [power_3 [20000/200000]
power_3 [30000/200000]
20000/200000]
power_5 [30000/200000]
power_5 [40000/power_3 [40000/200000]
power_3 [50000200000]
power_5 [50000/200000]
power_5 [60000//200000]
power_3 [60000/200000]
200000]
power_5 [70000/200000]
power_5 [power_3 [70000/200000]
power_3 [80000/200000]
80000/200000]
power_5 [90000/200000]
power_3 [90000/200000]
power_3 [100000/200000]
power_5 [100000/200000]
power_5 [110000/200000]
power_3 [110000/200000]
power_3 [120000/200000]
power_5 [120000/200000]
power_5 [130000/200000]
power_3 [130000/200000]
power_3 [140000/200000]
power_5 [140000/200000]
power_5 [150000/200000]
power_3 [150000/200000]
power_3 [160000/200000]
power_5 [160000/200000]
power_5 [170000/200000]
power_3 [170000/200000]
power_3 [180000/200000]
power_5 [180000/200000]
power_5 [190000/200000]
power_3 [190000/200000]
power_3 [200000/200000]
3^200000 = 871008973
Test power_3 OK!
App 0 is exited
power_5 [200000/200000]
5^200000 = 670295496power_7 [10000/200000]

Test power_5 OK!
App 1 is exited
power_7 [20000/200000]
power_7 [30000/200000]
power_7 [40000/200000]
power_7 [50000/200000]
power_7 [60000/200000]
power_7 [70000/200000]
power_7 [80000/200000]
power_7 [90000/200000]
power_7 [100000/200000]
power_7 [110000/200000]
power_7 [120000/200000]
power_7 [130000/200000]
power_7 [140000/200000]
power_7 [150000/200000]
power_7 [160000/200000]
power_7 [170000/200000]
power_7 [180000/200000]
power_7 [190000/200000]
power_7 [200000/200000]
7^200000 = 277895943
Test power_7 OK!
App 2 is exited
Test sleep OK!
App 3 is exited
panic: 'app end'
``` 
### 主要动机
进一步提高整个应用的CPU利用率/交互性与任务之间的公平性
因此需要实现强制任务切换，并引入中断，可采用如下方法：
时钟中断：基于时间片进行调度
（不在这里引入）串口中断：在发出输出请求后，不是轮询忙等，而是中断方式响应
### 用户程序
[wyf 的具体实现]三个计算质数幂次的小程序，外加一个 sleep 的程序。here
[jyk] 死循环（用户程序） + 一段时间后杀死（内核）。
### 内核应完成功能
实现时钟/串口中断处理，以及基于中断的基本时间片轮转调度
### 新增系统调用
sys_get_time：返回当前的 CPU 时钟周期数