# Chapter2 批处理系统
## 完成情况
* 成功设置内核和用户运行的栈，支持内核栈和用户栈之间的切换。
* 实现了特权级切换、进程上下文保存和恢复的工作。
* 应用程序数量固定，若增加或者删除应用程序的数量，需要对代码进行修改；用户程序和内核存放在一起，编译完成后用户地址还在内核中，并没有实现真正的分离。
* 没有实现杀死程序并切换下一个的功能，此功能会在以后实现。
```
OpenSBI v0.6
   ____                    _____ ____ _____
  / __ \                  / ____|  _ \_   _|
 | |  | |_ __   ___ _ __ | (___ | |_) || |
 | |  | | '_ \ / _ \ '_ \ \___ \|  _ < | |
 | |__| | |_) |  __/ | | |____) | |_) || |_
  \____/| .__/ \___|_| |_|_____/|____/_____|
        | |
        |_|

Platform Name          : QEMU Virt Machine
Platform HART Features : RV64ACDFIMSU
Platform Max HARTs     : 8
Current Hart           : 0
Firmware Base          : 0x80000000
Firmware Size          : 120 KB
Runtime SBI Version    : 0.2

MIDELEG : 0x0000000000000222
MEDELEG : 0x000000000000b109
PMP0    : 0x0000000080000000-0x000000008001ffff (A)
PMP1    : 0x0000000000000000-0xffffffffffffffff (A,R,W,X)
hello world
App 1 is exited
sum = 15
App 2 is exited
panic: 'app end!'
```
### 主要动机
    内核不会被应用程序破坏
### 用户程序
    支持应用进行计算与结果输出。在裸机上输出 Hello world，就像在其他 OS 上一样。但应用程序无法破坏内核，但能得到内核的服务。
app列表：
* hello_world：输出字符串。
* count_sum：累加一维数组的和，并输出结果。

### 内核应完成功能
    设置好内核和用户运行的栈，内核初始化完成后通过 sret 跳转到用户程序进行执行，然后在用户程序系统调用的时候完成特权级切换、上下文保存/恢复及栈的切换。
    
    按顺序加载运行多个应用程序。当应用程序出错（非法指令基于 RustSBI 不容易完成，比如访问非法的物理地址）之后直接杀死应用程序并切换到下一个。
### 新增系统调用
* sys_write：向串口写
* sys_exit： 表明任务结束。